
import asyncio
from telegram import Update, ReplyKeyboardRemove
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from telegram.ext import filters as tg_filters
import sys
import asyncio
import telebot
from aiogram.client.bot import DefaultBotProperties
from aiogram import Bot, Dispatcher, F, types
from aiogram.types import Message
from aiogram.enums import ParseMode
from allGPT.adaptatsiya import get_response, USER_STATES
import nest_asyncio
from allGPT import matematika,fizika,biologiya,khimiya,geografiya,astronomiya,informatika,literatura,lingvistika,istoriya,filosofiya,psikhologiya,ekonomika,politika,sotsiologiya,logika,statistika,geometriya,algebra,trigonometria,kompyutery,noutbuki,smartfony,tekhnologii,programmirovanie,vebrazrabotka,frontend,backend,bazydannykh,iskusstvennyyintellekt,neironnye_seti,mashinnoeobuchenie,analitikadannykh,robototekhnika,internetveshchey,mobilnyeprilozheniya,igrirazrabotka,geymdev,unity,unrealengine,gity,terminal,linux,windows,macos,android,ios,bezopasnost,kriptografiya,seti,servera,hosting,oblakatechnologii,virtualizatsiya,docker,kubernetes,devops,testirovanie,avtomatizatsiya,api,restapi,graphql,html,css,javascript,typescript,python,java,csharp,cpp,golang,rust,php,sql,nosql,mongodb,postgresql,mysql,sqlite,redis,firebase,blokchain,kriptovalyuty,bitcoin,ethereum,defi,nft,finansy,investitsii,fondoviyrynok,banki,kredity,strakhovanie,byudzhetirovanie,nalogi,ekonomiyadeneg,lichnyefinansy,biznes,startapy,marketing,reklama,smm,seo,kontentmarketing,kopiraiting,blogging,youtube,streaming,twitch,tik_tok,instagram,vk,telegram,discord,kommunikatsii,prezentatsii,softskills,time_management,produktivnost,motivatsiya,psikhologicheskoezdorovye,stress,meditatsiya,zdorove,fizkultura,sport,fitnes,yoga,pitaniye,dieta,son,biohaking,meditsina,anatomia,farmatsiya,virusologiya,immunologiya,vaktsiny,pandemii,kliniki,diagnostika,lechenie,surgery,zabolevaniya,psikhoterapiya,obrazovanie,shkola,vuz,ucheba,kursy,samoobrazovanie,uchebniki,praktika,ekzameny,ege,oge,olimpiady,naushnyeissledovaniya,eksperimenty,teoriya,praktika2,karera,rezume,sovetysobesedovanie,rabota,freelance,vakansii,rezyume,linkedin,office,excel,word,powerpoint,notion,slack,jira,figma,design,uiux,grafikadizayn,foto,video,montazh,animatsiya,modelirovanie,ar,vr,kino,serialy,muzyka,albomy,koncerty,instrumenty,gitary,fortepiano,sintezator,vokal,rap,rok,pop,klassika,jaz,elektronika,edm,housemusic,punkrock,indierock,metall,grunge,blues,country,reggae,kpop,jpop,filmproduction,kinosnyatie,scenariy,rezhissura,operator,svet,zvukozapisy,dubbing,aktery,casting,kinokritika,kinopremii,oscars,cannes,filmmaking,muzey,vystavki,iskusstvo,zhivopis,skulptura,grafika,arhitektura,dizayninternov,landshaft,urbanistika,stroitelstvo,remont,kvartira,dom,dacha,interer,mebel,kuhnya,vanna,spalnya,gostinaya,osveshchenie,teplo,konditsioner,santekhnika,stroymaterialy,instrumenty,elektrika,bezopasnostdoma,videonablyudenie,umnyydom,homeassistant,alexa,siri,iot,tehnika,bytovaya,holodilnik,mikrovolnovka,plita,stiralnaya,pylesos,klimat,elektronika,televizory,monitory,naushniki,kolonki,audiotekhnika,fotoapparaty,videokamery,geyming,konsoli,playstation,xbox,nintendo,steam,epicgames,onlineigry,shutery,strategii,rpg,mmo,mobilnyeigry,puzzle,gonki,fighting,simulyatory,vizualnienovelly,streamingigry,gamepads,klaviatury,myshki,monitoryigrovy,vrheadsets,gamingchairs,modding,twitchstream,youtubeigry,letplay,tournaments,esports,dota2,csgo,valorant,leagueoflegends,fortnite,pubg,apexlegends,genshinimpact,roblox,minecraft,sandbox,konstruktory,lego,arduino,raspberrypi,elektronnyekomponenty,tri_de_pechat,cnc,mehanika,avtomatika,elektrotekhnika,roboty,drony,kvadrokoptery,aviatsiya,kosmos,issledovaniyakosmosa,spacex,nasa,kosmonavty,mezhplanetnye,issledovaniya,mars,luna2,sputnik2,orbity,mezhzvezdnoe,teleskopy,kosmicheskayafizika,teoriyaotnositelnosti,kvantovayafizika,atomy,yadra,fizikaelementarnykh,energiyayadra,termodinamika,mekhanika,optyka,volny,zvukovayafizika,svet,lazery,fotonika,elektromagnetizm,soprotivlenie,zaryady,pole,elektroenergiya,elektrostantsii,gidroenergiya,vetroenergiya,solnechnayatekh,atomnayatekh,neft,gaz,ugol,alternativnaya,ekologiya,klimat,izmenenie,resursy,pererabotka,zelenye_tekhnologii,ustoychivoe_razvitie,zero_waste,ekoaktivizm,volontery,dobrovolchestvo,blagotvoritelnost,obshchestvo,sotsialnyeseti,media,zhurnalistika,novosti,pressa,intervyu,dokumentalnoe,publitsistika,publichnyevystupleniya,rechi,debates,oratorstvo,smi,televidenie,radio,podcasty,blogi,vlogi,novostnoyportal,forumy,chaty,kommentarii,tsenzura,svobodaslova,pravo,zakon,konstitutsiya,sud,advokaty,notarius,ugolovnoepravo,grazhdanskoepravo,trudovoepravo,semeinoyepravo,nasledstvo,konflikty,mediatsiya,ugolovnye_dela,sudyebnayasistema,prokuratura,politsiya,pravookhraniteli,pravozashchita,prava_cheloveka,internacionalnoepravo,mirovayapolitika,diplomatiya,oon,nato,es,ssha,rossiya,kitay,india,afrika,blizhniyvostok,ukraina,voennyevoprosy,vooruzheniye,bezopasnostvstrane,armeiya,voennaya_tekhnika,geopolitika,istoriya_vojny,istoriyamira,kulturnoenasledie,tradicii,religiya,filosofy,etika,moral,kultura,iskusstvo_v_mire,natsionalnyekultury,prazdniki,obychai,narodnye_tantsy,folklor,literaturnyezhanry,proza,poeziya,drama,fantastika,detektivy,romany,klassika,sovremennaya_literatura,knigi,avtory,knizhnyeklub,chitateli,knizhnyerezensii,knigoizdanie,elektronnyeknigi,audioknigi,chtenie,obrazovanie_21vek,onlayn_obuchenie,kursyprogrammirovaniya,shkolnye_predmety,uchebnye_platformy,udemy,coursera,stepik,skillbox,geekbrains,youtube_obuchenie,tik_tok_edu,instagram_kursy,lichnayy_rost,samoocenka,emotsionalny_intellekt,obshchenie,otnosheniya,drugi,semya,roditeli,vospitanie,deti,podrostki,shkolniki,studenty,rabotodateli,kollektiv,teamwork,liderstvo,startup_komanda,biznes_idei,prodvizhenie,prodazhi,klienty,servis,konsultatsii,feedback,reputatsiya,kliyentskiy_opyt,biznes_modeli,franshizy,marketplace,elektronnayatorgovlya,internetmagaziny,amazon,ozon,wildberries,aliexpress,ebay,marketology,analitikarynka,konkurenty,niche,productmarketfit,razvitie,scaleup,exit,investory,venchurfondy,crowdfunding,kickstarter,patenty,avtorskoepravo,intellekt_sobstvennost,brendy,firmennyy_stil,logotipy,upakovka,reklamnye_roliki,targeting,kontekstnaya_reklama,seo_strategiya,sem,email_marketing,newsletter,avtomatizatsiya_biznesa,buhgalteriya,zarplata_i_kadry,otchetnost,nalogovaya,audit,finmonitoring,finotchetnost,kriptobuhgalteriya,fintech,bankovskie_uslugi,mobilnyy_banking,karty,kredity_dlya_biznesa,ipotechnoe_kreditovanie,kreditnaya_istoriya,finansovye_riski,strahovye_sluchai,dorozhnaya_strakhovka,zdorovie_i_strakhovanie,turistskaya_strakhovka,finansovoe_planirovanie,investirovanie_vnedvizhimost,arenda,pokupka_kvartiry,ipoteka,zhkkh,kvartplata,upravlyayushchaya_kompaniya,remont_kvartiry,vnutrennyaya_otdelka,dizayn_remonta,stroitelstvo_doma,fundament,krysha,otoplenie,ventilyatsiya,okna,dveri,mebel_na_zakaz,interer_pod_kluch,umnyy_interer,domashniy_ofis,kompyuternaya_mebel,osveshchenie_v_interere,dekor,domashniye_rasteniya,sad_i_ogorod,ogorodnichestvo,teplica,poliv,udobreniya,zashchita_rasteniy,kompost,sadovye_instrumenty,dachnyy_sezon,sadovaya_mebel,peyzazhnyy_dizayn,besedki,barbekyu,gril,otdykh_na_prirode,pikniki,palatki,poezdki,avtoputeshestvie,turizm,poisk_aviabiletov,bronirovanie,oteli,airbnb,gidy,jekskursii,mestnye_kukhni,kulinarniye_tury,ekoturizm,trekking,alpinism,gory,more,plavanie,plyazhi,snorkeling,dayving,priklyucheniya,ekspeditsii,nablyudenie_za_zhivotnymi,safari,arktika,antarktida,severny_polyus,ostrova,karaiby,yuzhnaya_amerika,afrika_tury,evropa,aziya,rossiya_puteshestviya,sibir,ural,kavkaz,dalniy_vostok,baikal,altay,kamchatka,zolotoe_koltso,moskva,sankt_peterburg,goroda_rossii,kulturnye_meropriyatiya,koncerty_v_rossii,festivali,teatry,balet,muzykalnye_teatry,detskaya_scena,kinopokazy,kinofestivali,dokumentalnye_filmy,nezavisimoe_kino,rossiyskoe_kino,zarubezhnoe_kino,aktery_i_aktrisy,rezhissery,stsena,kinostudii,ozvuchka,specialnye_effekty,grafika_v_kino,tri_de_animatsiya,vizualnye_effekty,videomontazh,kinomontazh,treningi,seminary,konferentsii,vebinary,master_klass,obuchenie_online,sertifikaty,prokachka_navikov,kariernye_konsultatsii,personal_brand,portfolio,motivatsionnoe_pismo,sovety_po_karere,rabota_na_frilanse,zakazchiki,kak_nayti_klientov,freelance_platformy,upwork,freelancer,kwork,habr_freelance,disayn_na_zakaz,veb_dizayn,logotipy_na_zakaz,graficheskiy_dizayn,moukapy,figma_praktika,interfeysy,prototipirovanie,user_experience,user_interface,testirovanie_dizayna,product_dizayn,ilustratsii,risovanie_na_planshete,digital_art,komiksy,manga,artbooki,pechatnaya_produktsiya,vizitki,buklety,broshyury,katalogi,upakovka_tovarov,torgovaya_marka,marketpleysy,marketolog_na_freelance,smm_strategiya,targetirovannaya_reklama,insta_reklama,vk_target,facebook_ads,tiktok_ads,youtube_kanal,razvitie_kanala,monetizatsiya,donaty,patreon,boosty,zen_kanal,telegram_kanal,chat_boty,avtomatizatsiya_chatov,ai_skripty,midjourney,stabil_diffusion,ai_v_dizayne,ai_v_kontente,generatsiya_kontenta,teksty_na_zakaz,kopiraiting_dlya_saytov,seo_kopiraiting,lendingy,stranitsy_prodazh,konversii,analitika_sayta,google_analytics,yandex_metrika,heatmaps,optimizatsiya_stranits,user_journey,konversiya,povedenie_polzovateley,ux_issledovaniya,lichnye_finansy,byudzhetirovanie,koplenie_sredstv,investitsii_dlya_nachinayushchih,kriptovalyuty,bitcoin,ethereum,kriptokoshelki,nft,blokcheyn,defi,kriptotorgovlya,kriptobirzhi,kriptobezopasnost,metavers,web3,digital_identity,virtualnaya_realnost,augmented_reality,realnost_i_tehnologii,tehnologii_budushchego,iskusstvennyy_intellekt,machine_learning,deep_learning,neural_seti,kompyuternoe_zrenie,obrabotka_teksta,nlu,nlg,chatgpt,openai,yandex_gpt,ai_in_business,ai_v_marketinge,ai_v_meditsine,ai_v_obrazovanii,ai_v_bytovoy_zhizni,ai_v_igrakh,ai_v_zvuke,ai_v_grafike,generativnyy_ai,stable_diffusion_art,prompt_engineering,prompt_konstruktor,avtomatizatsiya_rutiny,obshchenie_s_ai,ai_assistenty,tekhnologii_umnogo_doma,smart_home_gadgets,umnyy_holodilnik,umnaya_kolonka,umnyy_televizor,umnyy_domofon,iot_ustroystva,seti_5g,wi_fi_6,mobilnye_seti,sotovaya_svyaz,svyaz_v_budushchem,razrabotka_prilozheniy,mobilnaya_razrabotka,android_studio,xcode_ios,flutter,react_native,krossplatforma,frontend,backend,fullstack,html_css_js,typescript,react_js,vue_js,svelte,node_js,express_js,django,flask,fastapi,postgresql,mongodb,mysql,redis,graphql,restapi,docker,kubernetes,devops,github_actions,ci_cd,vcs_git,unit_testy,pytest,selenium,testirovanie_ui,manual_testing,qa_engineer,bug_tracking,jira,agile,scrum,kanban,task_manager,notion,trello,monday_com,product_manager,ux_writer,bizdev,hr_tehnologii,rekruting,soprovozhdenie_sotrudnikov,korporativnaya_kultura,onboarding,tim_bilding,psikhologiya_komandy,emotsionalnoe_vygoranie,mentalnoe_zdorovye,psikhoterapiya,samopodderzhka,rezhim_dnya,son,sport,zdorovoe_pitanie,veganstvo,vegetarianstvo,keto,intermittent_fasting,nabor_massy,pohudenie,trenirovki_doma,zaryadka,fitnes_klub,krossfit,yoga,stretching,plavanie_zanyatiya,boevye_iskusstva,boks,mma,karate,dzhiu_dzhitsu,kendo,sportsmeny,olimpiyskie_igry,chempionaty,sportivnaya_ekipirovka,zdorovye_sustavy,profilaktika_travm,meditsina_sporta,biokhimiya,biologiya,anatomia,fiziologiya,genetika,kletki,DNK,genomika,epigenetika,sintez_belkov,mutatsii,biotekhnologii,meditsina_21_vek,vaktsiny,immunitet,antitela,pandemii,epidemiologiya,virusologiya,mikrobiologiya,bakterii,gribki,antibiotiki,diagnostika,kt_mrt,laboratornye_analizy,meditsinskoe_oborudovanie,nosimye_ustroystva,fitness_trekery,smart_chasy,zdravookhranenie,medtech,digital_medicine,telemeditsina,meditsinskie_sertifikaty,farmatsevtika,apteki_online,meditsinskiy_turizm,zdorovyy_obraz_zhizni,psikhologicheskoe_zdorovye,lichnaya_effektivnost,planirovanie_dnya,postanovka_tsely,dostizhenie_rezultatov,motivatsiya,tselustremlyonnost,rabota_nad_oshibkami,obratnaya_svyaz,samoanaliz,reflleksiya,emotsii,vzaimootnosheniya,nastroenie,samoregulyatsiya,osoznannost,meditatsiya,dyhatelnye_praktiki,praktika_blagodarnosti,dnevnik,vedenie_zapisey,tsifrovoy_detoks,sokrashchenie_stressa,priroda_kak_terapiya,kreativnost,vizualizatsiya_tseley,myshlenie_rasta,zivotnie,kompeteri,recepti,posuda,tekhniki,snaryad,poezda,autobusi,pokupki,produkti,uvelicheniye,ustroystva,diski,samovyvoz,psikhologi,medicina,tovarov,dostavka,skidki,sozdanie,razdel,ekspertiza,dlya_podroste,roboty,obmen,skidka,otzyvy,prosto,prazdniki,pervichnoye,kompaniya,forumi,katastrofi,otoplenie,polet,siberia,chemistry,kolledzhi,mineralnye,palatki,volontyorstvo,otnosheniya,vstrechi,nastroyki,liudi,sait,birzhi,gnomy,dostizheniya,kivka,tikhie,domiki,metody,ekstremalnye,stoliki,tech_volontyorstvo,kultura,vodovoz,napravleniya,segodnya,technologii,morye,citaty,chestnie,informacii,mirki,spetsialisti,seti,kreativ,komplekt,izgotovlenie,proekty,monitoring,nastupaiushchee,metody_issledovaniya,otlichiya,izmenenie,sostavlyayushchie,iskusstvenniy,scenarii,tehnicheskie,sozdaniya,projekty,ekspansiya,oborudovanie,soglasovanie,testirovki,webinar,kompanii,reestr,tseny,oformlenie,tema,velosipedi,tury,tvorchestvo,samouchka,smi,knigi,materialy,obzory,raznoe,rabatka,tekhniki_rabotyi,dostupnosti,programmnye,sovety,rabotniki,testirovanie,ispolnitel,samodielka,izmerenie,strakhovanie,optimizatsiya,sovmeshchenie,editirovanie,dizajn_intererov,plastik,programmy,voennaia,programy_rabotayut,pokupateli,proektirovanie,sistemnyye,razmetka,inzheneriya,avtoelektrika,proverki,izmeritel,adaptatsiya,vibratory,produktov,tovaryi,uslugi,planovanie,razvlecheniya,ekologiya,chistota,trekking,velosipedi2,podklyucheniye,tsikly,zashchita,izdelie,kombinatsii,otvetstvennost,raznoobraznye,text_3,ideal

nest_asyncio.apply()

bot = telebot.TeleBot("8194190025:AAE_CMGzm2zBSCqeOco0vYzXVOPHO1O8_HY")

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "👋 Привет! Этот 🤖 бот разработан Яйцом Глеба. Я постоянно 🏗️ развиваюсь и 📚 учусь, так что не стесняйтесь задавать мне вопросы! 💡"
    )

# Обработчик сообщений, который анализирует ввод пользователя через логику функции get_response
async def echo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.message.chat.id
    user_text = update.message.text
    # Получаем текущее состояние диалога, если его ещё нет – берём "start"
    current_state = USER_STATES.get(chat_id, "start")
    # Вызываем функцию логики диалога
    reply, new_state = get_response(user_text, current_state)
    USER_STATES[chat_id] = new_state
    await update.message.reply_text(reply)

async def main():
    app = Application.builder().token("YOUR_BOT_TOKEN_HERE").build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
    await app.initialize()
    await app.start()
    print("Бот запущен")
    await app.updater.start_polling()
    try:
        await asyncio.Event().wait()  # чтобы приложение не завершалось
    except KeyboardInterrupt:
        pass
    finally:
        await app.updater.stop()
        await app.stop()
        await app.shutdown()

# Универсальный запуск (обходит проблему работающего event loop)
if __name__ == "__main__":
    try:
        if sys.platform.startswith("win") and sys.version_info >= (3, 8):
            asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
        asyncio.run(main())
    except RuntimeError as e:
        if str(e).startswith("Cannot close a running event loop"):
            loop = asyncio.get_event_loop()
            loop.run_until_complete(main())
